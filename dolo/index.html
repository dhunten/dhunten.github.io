<!doctype html>

<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Share your location in Dolores Park</title>
        <meta name="description" content="Easily pick a spot with a grid so your friends can easily find you. Toggle shade, elevation, and references.">
        <link rel="shortcut icon" href="/assets/pointer.gif">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://derek.town/dolo/">
        <meta property="og:title" content="Share your location in Dolores Park">
        <meta property="og:description" content="Easily pick a spot with a grid so your friends can easily find you. Toggle shade, elevation, and references.">
        <meta property="og:image" content="https://derek.town/dolo/images/preview.png">
        <meta property="twitter:card" content="summary_large_image">
        <meta property="twitter:url" content="https://derek.town/dolo/">
        <meta property="twitter:title" content="Share your location in Dolores Park">
        <meta property="twitter:description" content="Easily pick a spot with a grid so your friends can easily find you. Toggle shade, elevation, and references.">
        <meta property="twitter:image" content="https://derek.town/dolo/images/preview.png">

        <style type="text/css">
            body {
                background: #111;
                color: #ddd;
                margin: 0;
                /* text-align: center; */
                font-family: sans-serif;
            }
            .dolo {
                position: fixed;
                background: url("images/base.png");
                background-size: contain;
                background-repeat: no-repeat;
                background-position: center;
                top: 0; right: 0; bottom: 0; left: 0;
            }
            .dolo > div {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background-size: contain;
                background-repeat: no-repeat;
                background-position: center;
            }
            #key { background-image: url("images/key.png"); }
            #poi { background-image: url("images/poi.png"); }
            #items { background-image: url("images/items.png"); }
            #sidewalks { background-image: url("images/sidewalks.png"); }
            #shade { background-image: url("images/shade.png"); }
            #elevation { background-image: url("images/elevation.png"); }
            #grid { background-image: url("images/grid.png"); }

            .optionstoggle {
                padding: 20px;
                width: 20px;
                height: 20px;
                position: fixed;
                bottom: 0;
            }

            #pin {
                position: fixed;
                display: none;
                width: 32px;
                height: 48px;
            }

            #pin img {
                display: block;
                width: 100%;
                height: 100%;
                object-fit: contain;
            }

            #options {
                position: fixed;
                right: 0; bottom: 0; left: 0;
                background: #222;
            }

            .closeheader {
                margin: 16px;
            }

            .togglegroup {
                margin: 16px;
                display: flex;
                flex-wrap: wrap;
                flex-direction: row;
                gap: 8px;
            }

            label {
                display: block;
                padding: 8px 12px;
                border-radius: 420px;
                border: 1px solid #ffffff11;
            }
            input {
                display: none;
            }

            label:has(input:checked) {
                background: #ffffff11;
            }
        </style>
        <script>

            function toggleLayer(id) {
                if (document.querySelector(id).style.display == 'none') {
                    document.querySelector(id).style.display = 'block';
                } else {
                    document.querySelector(id).style.display = 'none';
                }
            }

            function setLayers() {
                const layerGrid = document.querySelector("#gridcheck");
                const layerKey = document.querySelector("#keycheck");
                const layerPOI = document.querySelector("#poicheck");
                const layerItems = document.querySelector("#itemscheck");
                const layerSidewalks = document.querySelector("#sidewalkscheck");
                const layerShade = document.querySelector("#shadecheck");
                const layerElevation = document.querySelector("#elevationcheck");
                
                document.querySelector("#grid").style.display       = (layerGrid.checked        ? "block" : "none");
                document.querySelector("#key").style.display        = (layerKey.checked         ? "block" : "none");
                document.querySelector("#poi").style.display        = (layerPOI.checked         ? "block" : "none");
                document.querySelector("#items").style.display      = (layerItems.checked       ? "block" : "none");
                document.querySelector("#sidewalks").style.display  = (layerSidewalks.checked   ? "block" : "none");
                document.querySelector("#shade").style.display      = (layerShade.checked       ? "block" : "none");
                document.querySelector("#elevation").style.display  = (layerElevation.checked   ? "block" : "none");
            }

            function toggleOptions() {
                toggleLayer("#options");
            }

            </script>
    </head>
    <body>
        <div class="dolo">
            <div id="elevation"></div>
            <div id="shade"></div>
            <div id="sidewalks"></div>
            <div id="items"></div>
            <div id="grid"></div>
            <div id="poi"></div>
            <div id="key"></div>
            <div id="pin"><img src="/assets/pointer.gif" alt="pointer"></div>
        </div>

        <div class="optionstoggle" onClick="toggleOptions()">‚öôÔ∏è</div>

        <div id="options" style="display: none;">
            <div class="closeheader" onClick="toggleOptions()">‚ùå</div>
            <div class="togglegroup" onClick="setLayers()">
                <label for="poicheck"><input type="checkbox" id="poicheck" checked/>üöª üöå</label>
                <label for="itemscheck"><input type="checkbox" id="itemscheck" checked/>üå≥ ü™ë</label>
                <label for="sidewalkscheck"><input type="checkbox" id="sidewalkscheck" checked/>üëü Sidewalks</label>
                <label for="gridcheck"><input type="checkbox" id="gridcheck" checked/>üåê Grid</label>
                <label for="shadecheck"><input type="checkbox" id="shadecheck"/>üåÑ Shade</label>
                <label for="elevationcheck"><input type="checkbox" id="elevationcheck"/>‚õ∞Ô∏è Elevation</label>
                <label for="keycheck"><input type="checkbox" id="keycheck"/>üîë Key</label>
            </div>
        </div>

    </body>

    <script>setLayers();</script>

    <script>
        const PIN_WIDTH = 32;
        const PIN_HEIGHT = 48;
        const pinElement = document.getElementById('pin');
        const obj = pinElement.style;

        function mouseX(e) {if (!e) e = window.event; if (e.pageX) return e.pageX; else if (e.clientX)return e.clientX + (document.documentElement.scrollLeft ?  document.documentElement.scrollLeft : document.body.scrollLeft); else return 0;}
        function mouseY(e) {if (!e) e = window.event; if (e.pageY) return e.pageY; else if (e.clientY)return e.clientY + (document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop); else return 0;}
        
        function updatePinPosition(x, y) {
            obj.left = x + '%';
            obj.top = y + '%';
            obj.display = 'block';
        }

        function follow(e) {
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;
            
            const targetX_pixels = mouseX(e) - (PIN_WIDTH * 2/5);
            const targetY_pixels = mouseY(e) - (PIN_HEIGHT * 1/3);

            const leftPercentage = (targetX_pixels / viewportWidth) * 100;
            const topPercentage = (targetY_pixels / viewportHeight) * 100;

            updatePinPosition(leftPercentage, topPercentage);

            const url = new URL(window.location);
            url.searchParams.set('x', leftPercentage.toFixed(1)); 
            url.searchParams.set('y', topPercentage.toFixed(1));
            window.history.replaceState({}, '', url);
        }

        function loadPinFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const x_str = urlParams.get('x');
            const y_str = urlParams.get('y');

            if (x_str === null || y_str === null) { return; }

            const x = parseFloat(x_str);
            const y = parseFloat(y_str);

            updatePinPosition(x, y);
        }

        document.querySelector(".dolo").onclick = follow;

        loadPinFromURL();
      </script>
</html>